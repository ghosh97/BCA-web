<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <title>Gallery - Durga Puja 2K25 Barcelona</title>
    <meta name="description" content="Photo Gallery of Durga Puja 2K25 Barcelona.">
    <meta name="author" content="Bengali Cultural Association Barcelona">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Gallery - Durga Puja 2K25 Barcelona">
    <meta property="og:description" content="View photos from previous Durga Puja celebrations in Barcelona">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://bcaspain.github.io/gallery.html">
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZHNQ37V3SX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-ZHNQ37V3SX');
    </script>

    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="mobile-fixes.css">
    
    <!-- Favicon - Using existing logo as favicon -->
    <link rel="icon" type="image/jpeg" href="bca-logo-another.jpg">
</head>
<body class="scroll-container">
    <div class="main-content">
        <!-- Navigation Bar -->
        <nav class="navbar" id="navbar">
            <div class="nav-container">
                <div class="nav-logo">
                    <a href="index.html" style="text-decoration: none; color: inherit; display: inline-flex; align-items: center; gap: 10px;">
                        <span class="logo-img" style="display: inline-block;">
                            <img src="bca-logo-another.jpg" alt="BCA Spain Logo" style="width:50px;height:50px;border-radius:50%;object-fit:cover;vertical-align:middle;" />
                        </span>
                        <span class="logo-text" style="font-size: 1.3rem; font-weight: 600; display: inline-block; vertical-align:middle;">BCA Spain</span>
                    </a>
                </div>
                
                <div class="nav-menu" id="nav-menu">
                    <a href="index.html" class="nav-link">Home</a>
                    <a href="about.html" class="nav-link">About</a>
                    <a href="events.html" class="nav-link">Attractions</a>
                    <a href="schedule.html" class="nav-link">Schedule</a>
                    <a href="gallery.html" class="nav-link active">Gallery</a>
                    <a href="registration.html" class="nav-link">Registration</a>
                    <a href="contact.html" class="nav-link">Contact</a>
                </div>
                
                <div class="nav-toggle" id="nav-toggle">
                    <span class="bar"></span>
                    <span class="bar"></span>
                    <span class="bar"></span>
                </div>
            </div>
        </nav>

    <!-- Gallery Section -->
    <section id="gallery" class="gallery-section" style="margin-top:80px;">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Photo Gallery</h2>
                <p class="section-subtitle">Relive the magical moments from previous celebrations</p>
            </div>
            
            <div class="gallery">
                <div class="gallery-item">
                    <img src="gallery/g1.webp" alt="Durga Puja celebration with traditional decorations" />
                    <div class="gallery-overlay">
                        <div class="zoom-icon">üîç</div>
                        <span>Click to zoom</span>
                    </div>
                </div>
                <div class="gallery-item">
                    <img src="gallery/g2.webp" alt="Cultural performance during Durga Puja" />
                    <div class="gallery-overlay">
                        <div class="zoom-icon">üîç</div>
                        <span>Click to zoom</span>
                    </div>
                </div>
                <div class="gallery-item">
                    <img src="gallery/g3.webp" alt="Community gathering at Durga Puja celebration" />
                    <div class="gallery-overlay">
                        <div class="zoom-icon">üîç</div>
                        <span>Click to zoom</span>
                    </div>
                </div>
                <div class="gallery-item">
                    <img src="gallery/g4.webp" alt="Traditional rituals and ceremonies" />
                    <div class="gallery-overlay">
                        <div class="zoom-icon">üîç</div>
                        <span>Click to zoom</span>
                    </div>
                </div>
                <div class="gallery-item">
                    <img src="gallery/g5.webp" alt="Durga Puja decorations and lighting" />
                    <div class="gallery-overlay">
                        <div class="zoom-icon">üîç</div>
                        <span>Click to zoom</span>
                    </div>
                </div>
                
                <div class="gallery-item">
                    <img src="gallery/g6.webp" alt="Cultural dance performance" />
                    <div class="gallery-overlay">
                        <div class="zoom-icon">üîç</div>
                        <span>Click to zoom</span>
                    </div>
                </div>
                <div class="gallery-item">
                    <img src="gallery/g7.webp" alt="Traditional Bengali cuisine and food" />
                    <div class="gallery-overlay">
                        <div class="zoom-icon">üîç</div>
                        <span>Click to zoom</span>
                    </div>
                </div>
                <div class="gallery-item">
                    <img src="gallery/g8.webp" alt="Children participating in cultural activities" />
                    <div class="gallery-overlay">
                        <div class="zoom-icon">üîç</div>
                        <span>Click to zoom</span>
                    </div>
                </div>
                <div class="gallery-item">
                    <img src="gallery/g9.webp" alt="Durga Puja pandal decorations" />
                    <div class="gallery-overlay">
                        <div class="zoom-icon">üîç</div>
                        <span>Click to zoom</span>
                    </div>
                </div>
                <div class="gallery-item">
                    <img src="gallery/g10.webp" alt="Community members in traditional attire" />
                    <div class="gallery-overlay">
                        <div class="zoom-icon">üîç</div>
                        <span>Click to zoom</span>
                    </div>
                </div>
                
                <div class="gallery-item">
                    <img src="gallery/g11.webp" alt="Musical performances during celebration" />
                    <div class="gallery-overlay">
                        <div class="zoom-icon">üîç</div>
                        <span>Click to zoom</span>
                    </div>
                </div>
                <div class="gallery-item">
                    <img src="gallery/g12.webp" alt="Durga Puja idol and offerings" />
                    <div class="gallery-overlay">
                        <div class="zoom-icon">üîç</div>
                        <span>Click to zoom</span>
                    </div>
                </div>
                <div class="gallery-item">
                    <img src="gallery/g13.webp" alt="Traditional art and craft displays" />
                    <div class="gallery-overlay">
                        <div class="zoom-icon">üîç</div>
                        <span>Click to zoom</span>
                    </div>
                </div>
                <div class="gallery-item">
                    <img src="gallery/g14.webp" alt="Cultural workshop activities" />
                    <div class="gallery-overlay">
                        <div class="zoom-icon">üîç</div>
                        <span>Click to zoom</span>
                    </div>
                </div>
                <div class="gallery-item">
                    <img src="gallery/g15.webp" alt="Community bonding and celebrations" />
                    <div class="gallery-overlay">
                        <div class="zoom-icon">üîç</div>
                        <span>Click to zoom</span>
                    </div>
                </div>
                
                <div class="gallery-item">
                    <img src="gallery/a11.webp" alt="Durga Puja cultural program highlights" />
                    <div class="gallery-overlay">
                        <div class="zoom-icon">üîç</div>
                        <span>Click to zoom</span>
                    </div>
                </div>
                <div class="gallery-item">
                    <img src="gallery/a12.webp" alt="Traditional Bengali music performance" />
                    <div class="gallery-overlay">
                        <div class="zoom-icon">üîç</div>
                        <span>Click to zoom</span>
                    </div>
                </div>
                <div class="gallery-item">
                    <img src="gallery/a13.webp" alt="Durga Puja celebration atmosphere" />
                    <div class="gallery-overlay">
                        <div class="zoom-icon">üîç</div>
                        <span>Click to zoom</span>
                    </div>
                </div>
                <div class="gallery-item">
                    <img src="gallery/a14.webp" alt="Cultural heritage preservation activities" />
                    <div class="gallery-overlay">
                        <div class="zoom-icon">üîç</div>
                        <span>Click to zoom</span>
                    </div>
                </div>
                <div class="gallery-item">
                    <img src="gallery/a15.webp" alt="Community participation in rituals" />
                    <div class="gallery-overlay">
                        <div class="zoom-icon">üîç</div>
                        <span>Click to zoom</span>
                    </div>
                </div>
                <div class="gallery-item">
                    <img src="gallery/a16.webp" alt="Durga Puja celebration memories" />
                    <div class="gallery-overlay">
                        <div class="zoom-icon">üîç</div>
                        <span>Click to zoom</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Enhanced Lightbox Modal with Slider -->
    <div id="lightbox" class="lightbox">
        <span id="closeBtn" class="close">&times;</span>
        <button id="prevBtn" class="nav-btn prev-btn" aria-label="Previous image">
            <i class="fas fa-chevron-left" aria-hidden="true"></i>
        </button>
        <button id="nextBtn" class="nav-btn next-btn" aria-label="Next image">
            <i class="fas fa-chevron-right" aria-hidden="true"></i>
        </button>
        <div class="lightbox-content-wrapper">
            <img id="lightboxImg" class="lightbox-content" alt="Lightbox Image">
            <div class="image-counter">
                <span id="currentImage">1</span> / <span id="totalImages">21</span>
            </div>
            <div id="loadingIndicator" class="loading-indicator" style="display: none;">
                <div class="spinner"></div>
                <span>Loading image...</span>
            </div>
        </div>
    </div>
    </div> <!-- End main-content -->

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <img src="bca-logo-another.jpg" alt="BCA Spain Logo">
                    <span>Bengali Cultural Association Barcelona</span>
                </div>
                <p>
                    &copy; 2025 Bengali Cultural Association Barcelona. All rights reserved.
                </p>
            </div>
        </div>
    </footer>

    <!-- Back to Top Button -->
    <button id="back-to-top" class="back-to-top" onclick="scrollToTop()" aria-label="Back to top" title="Back to top">
        <i class="fas fa-arrow-up" aria-hidden="true"></i>
    </button>

    <!-- Loading Screen -->
    <!-- <div id="loading" class="loading">
        <div class="loading-content">
            <div class="spinner"></div>
            <p>Loading Durga Puja 2K25...</p>
        </div>
    </div> -->

    <!-- Smooth Scroll Polyfill -->
    <script>
        // Check if smoothscroll polyfill is needed
        if (!('scrollBehavior' in document.documentElement.style)) {
            // Load polyfill only if needed
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/smoothscroll-polyfill@0.4.4/dist/smoothscroll.min.js';
            script.onload = function() {
      smoothscroll.polyfill();
            };
            document.head.appendChild(script);
        }
    </script>

    <!-- Scripts -->
    <script src="script.js"></script>
    
    <!-- Fallback for users with JavaScript disabled -->
    <noscript>
        <style>
            .loading { display: none !important; }
            .gallery-overlay { opacity: 1 !important; }
            .gallery-overlay span { display: none !important; }
            .gallery-overlay .zoom-icon { display: none !important; }
        </style>
        <div style="background: #f8f9fa; padding: 20px; margin: 20px; border-radius: 10px; text-align: center;">
            <p><strong>JavaScript is disabled</strong></p>
            <p>Please enable JavaScript to use the interactive gallery features.</p>
        </div>
    </noscript>
    
    <!-- Enhanced Lightbox Slider Styles -->
    <style>
        /* Lightbox Modal */
        .lightbox {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(5px);
            opacity: 0;
            transition: all 0.3s ease;
            align-items: center;
            justify-content: center;
        }

        .lightbox.active {
            display: flex !important;
            opacity: 1 !important;
            visibility: visible !important;
        }
        
        /* Ensure lightbox is always on top */
        #lightbox {
            z-index: 999999 !important;
            pointer-events: auto !important;
        }
        
        /* Prevent body scrolling when lightbox is active */
        body.lightbox-open {
            overflow: hidden !important;
            position: fixed !important;
            width: 100% !important;
        }
        
        /* Reset any conflicting styles */
        #lightboxImg {
            opacity: 1 !important;
            visibility: visible !important;
            display: block !important;
        }

        /* Close Button */
        .close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            z-index: 1000000;
            transition: all 0.3s ease;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }

        .close:hover {
            color: #bbb;
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        /* Navigation Buttons */
        .nav-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 15px;
            border-radius: 50%;
            transition: all 0.3s ease;
            z-index: 1000000;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-50%) scale(1.1);
        }

        .prev-btn {
            left: 30px;
        }

        .next-btn {
            right: 30px;
        }

        /* Lightbox Content */
        .lightbox-content-wrapper {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .lightbox-content {
            max-width: 100%;
            max-height: 80vh;
            object-fit: contain;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transition: transform 0.3s ease;
            opacity: 1 !important;
            visibility: visible !important;
        }

        .lightbox-content:hover {
            transform: scale(1.02);
        }

        /* Image Counter */
        .image-counter {
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 18px;
            font-weight: 600;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
        }
        
        /* Loading Indicator */
        .loading-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
            z-index: 1000001;
        }
        
        .loading-indicator .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Gallery Items Enhancement */
        .gallery-item {
            transition: all 0.3s ease;
            overflow: hidden;
            border-radius: 10px;
        }

        .gallery-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .gallery-item img {
            transition: transform 0.3s ease;
        }

        .gallery-item:hover img {
            transform: scale(1.05);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .close {
                top: 15px;
                right: 20px;
                font-size: 30px;
                width: 40px;
                height: 40px;
            }

            .nav-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
                padding: 12px;
            }

            .prev-btn {
                left: 15px;
            }

            .next-btn {
                right: 15px;
            }

            .lightbox-content {
                max-width: 95%;
                max-height: 70vh;
            }

            .image-counter {
                font-size: 16px;
                padding: 8px 16px;
                bottom: -35px;
            }
        }

        @media (max-width: 480px) {
            .close {
                top: 10px;
                right: 15px;
                font-size: 25px;
                width: 35px;
                height: 35px;
            }

            .nav-btn {
                width: 45px;
                height: 45px;
                font-size: 18px;
                padding: 10px;
            }

            .prev-btn {
                left: 10px;
            }

            .next-btn {
                right: 10px;
            }

            .lightbox-content {
                max-width: 98%;
                max-height: 60vh;
            }

            .image-counter {
                font-size: 14px;
                padding: 6px 12px;
                bottom: -30px;
            }
        }

        /* Loading Animation - Removed conflicting opacity */
        .lightbox-content {
            opacity: 1 !important;
            transition: transform 0.3s ease;
        }

        /* Smooth transitions */
        .lightbox * {
            transition: all 0.3s ease;
        }
        
        /* Fixed Footer Styles */
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .footer {
            margin-top: auto !important;
            position: relative;
            bottom: 0;
            width: 100%;
        }
        
        /* Ensure gallery section takes available space */
        .gallery-section {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .gallery-section .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 100%;
        }
        
        /* Mobile container adjustments */
        @media (max-width: 768px) {
            .gallery-section .container {
                padding: 0;
                margin: 0;
            }
        }
        
        .gallery-section section {
            flex: 1;
        }
        
        /* Gallery Grid Layout */
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            padding: 2rem 0;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            justify-items: center;
        }
        
        /* Ultra-wide monitor optimization */
        @media (min-width: 1600px) {
            .gallery {
                grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
                max-width: 1600px;
                gap: 2rem;
                padding: 2.5rem 0;
            }
            
            .gallery-item {
                max-width: 450px;
            }
        }
        
        /* Very wide monitor optimization */
        @media (min-width: 2000px) {
            .gallery {
                grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
                max-width: 1800px;
                gap: 2.5rem;
                padding: 3rem 0;
            }
            
            .gallery-item {
                max-width: 500px;
            }
        }
        
        .gallery-item {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            aspect-ratio: 4/3;
            width: 100%;
            max-width: 400px;
        }
        
        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .gallery-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .gallery-item:hover img {
            transform: scale(1.05);
        }
        
        .gallery-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            color: white;
            text-align: center;
        }
        
        .gallery-item:hover .gallery-overlay {
            opacity: 1;
        }
        
        .gallery-overlay .zoom-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .gallery-overlay span {
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        /* Responsive Grid */
        @media (max-width: 1200px) {
            .gallery {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 1.2rem;
                max-width: 1200px;
                padding: 1.5rem 0;
            }
        }
        
        @media (max-width: 768px) {
            .gallery {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 1rem;
                padding: 1rem 1rem;
                max-width: 100%;
                margin: 0 auto;
                justify-items: center;
            }
            
            .gallery-item {
                aspect-ratio: 3/2;
                max-width: 100%;
                width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            .gallery {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 0.8rem;
                max-width: 100%;
                margin: 0 auto;
                padding: 0.5rem 0.5rem;
                justify-items: center;
            }
            
            .gallery-item {
                aspect-ratio: 1/1;
                max-width: 100%;
                width: 100%;
            }
            
            .gallery-overlay .zoom-icon {
                font-size: 1.5rem;
            }
            
            .gallery-overlay span {
                font-size: 0.8rem;
            }
        }
        
        /* Extra small screens */
        @media (max-width: 360px) {
            .gallery {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 0.5rem;
                margin: 0 auto;
                padding: 0.25rem 0.25rem;
                justify-items: center;
            }
            
            .gallery-item {
                aspect-ratio: 1/1;
                width: 100%;
            }
        }
        

    </style>
    
    <script>
      // Enhanced Gallery Slider functionality
      document.addEventListener('DOMContentLoaded', function() {
        console.log('Gallery page loaded, initializing enhanced slider...');
        
        // Get all elements
        const lightbox = document.getElementById('lightbox');
        const lightboxImg = document.getElementById('lightboxImg');
        const closeBtn = document.getElementById('closeBtn');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const currentImageSpan = document.getElementById('currentImage');
        const totalImagesSpan = document.getElementById('totalImages');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const galleryItems = document.querySelectorAll('.gallery-item');

        // Variables
        let currentImageIndex = 0;
        const totalImages = galleryItems.length;

        console.log('Found', totalImages, 'gallery items');
        console.log('Lightbox element:', lightbox);
        console.log('LightboxImg element:', lightboxImg);
        console.log('Close button:', closeBtn);
        console.log('Prev button:', prevBtn);
        console.log('Next button:', nextBtn);

        if (!lightbox || !lightboxImg || !closeBtn || !prevBtn || !nextBtn || !loadingIndicator) {
          console.error('Lightbox elements not found!');
          return;
        }

        // Update total images counter
        totalImagesSpan.textContent = totalImages;

        // Function to open lightbox with specific image
        function openLightbox(index) {
          console.log('openLightbox called with index:', index);
          
          // Validate index
          if (index < 0 || index >= totalImages) {
            console.error('Invalid image index:', index);
            return;
          }
          
          currentImageIndex = index;
          const img = galleryItems[index].querySelector('img');
          
          if (img) {
            console.log('Image found:', img.src);
            
            // Show loading indicator
            loadingIndicator.style.display = 'flex';
            
            // Preload image to ensure smooth display
            const preloadImg = new Image();
            preloadImg.onload = function() {
              // Hide loading indicator
              loadingIndicator.style.display = 'none';
              
              // Ensure lightbox is properly reset first
              lightbox.style.display = 'flex';
              lightbox.style.pointerEvents = 'auto';
              lightbox.classList.add('active');
              document.body.classList.add('lightbox-open');
              document.body.style.overflow = 'hidden';
              
              // Set image properties
              lightboxImg.src = img.src;
              lightboxImg.alt = img.alt;
              lightboxImg.style.opacity = '1';
              lightboxImg.style.visibility = 'visible';
              currentImageSpan.textContent = index + 1;
              
              // Update navigation buttons state
              updateNavigationButtons();
              
              console.log('Opened image', index + 1, 'of', totalImages);
            };
            
            preloadImg.onerror = function() {
              // Hide loading indicator
              loadingIndicator.style.display = 'none';
              console.error('Failed to load image:', img.src);
              alert('Failed to load image. Please try again.');
            };
            
            preloadImg.src = img.src;
          } else {
            console.error('No image found at index:', index);
          }
        }

        // Function to close lightbox
        function closeLightbox() {
          lightbox.classList.remove('active');
          lightbox.style.display = 'none';
          document.body.style.overflow = '';
          
          // Reset image properties
          lightboxImg.style.opacity = '1';
          lightboxImg.style.visibility = 'visible';
          
          // Clear any event listeners that might be stuck
          lightbox.style.pointerEvents = 'auto';
          
          // Remove body class
          document.body.classList.remove('lightbox-open');
          
          console.log('Lightbox closed');
        }

        // Function to show previous image
        function showPreviousImage() {
          currentImageIndex = (currentImageIndex - 1 + totalImages) % totalImages;
          openLightbox(currentImageIndex);
        }

        // Function to show next image
        function showNextImage() {
          currentImageIndex = (currentImageIndex + 1) % totalImages;
          openLightbox(currentImageIndex);
        }

        // Function to update navigation buttons visibility
        function updateNavigationButtons() {
          // Always show both buttons for better UX
          prevBtn.style.display = 'block';
          nextBtn.style.display = 'block';
        }

        // Add click listeners to gallery items
        galleryItems.forEach((item, index) => {
          console.log('Adding click listener to gallery item', index + 1);
          item.addEventListener('click', function(e) {
            console.log('Gallery item clicked:', index + 1);
            e.preventDefault();
            e.stopPropagation();
            openLightbox(index);
          });
          
          // Add visual feedback for click
          item.style.cursor = 'pointer';
        });

        // Navigation button listeners
        prevBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          showPreviousImage();
        });

        nextBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          showNextImage();
        });

        // Close button functionality
        closeBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          closeLightbox();
        });

        // Close lightbox when clicking outside the image
        lightbox.addEventListener('click', function(e) {
          if (e.target === lightbox || e.target.classList.contains('lightbox')) {
            e.preventDefault();
            e.stopPropagation();
            closeLightbox();
          }
        });

        // Keyboard navigation
        document.addEventListener('keydown', function(e) {
          if (!lightbox.classList.contains('active')) return;
          
          switch(e.key) {
            case 'Escape':
              closeLightbox();
              break;
            case 'ArrowLeft':
              showPreviousImage();
              break;
            case 'ArrowRight':
              showNextImage();
              break;
          }
        });

        // Touch/swipe support for mobile
        let touchStartX = 0;
        let touchEndX = 0;

        lightbox.addEventListener('touchstart', function(e) {
          touchStartX = e.changedTouches[0].screenX;
        });

        lightbox.addEventListener('touchend', function(e) {
          touchEndX = e.changedTouches[0].screenX;
          handleSwipe();
        });

        function handleSwipe() {
          const swipeThreshold = 50;
          const diff = touchStartX - touchEndX;
          
          if (Math.abs(diff) > swipeThreshold) {
            if (diff > 0) {
              // Swipe left - next image
              showNextImage();
            } else {
              // Swipe right - previous image
              showPreviousImage();
            }
          }
        }

        console.log('Enhanced gallery slider initialization complete!');
        
        // Test function - you can call this in browser console to test lightbox
        window.testLightbox = function() {
          console.log('Testing lightbox...');
          if (galleryItems.length > 0) {
            openLightbox(0);
          } else {
            console.error('No gallery items found');
          }
        };
        
        // Emergency cleanup function
        window.forceCloseLightbox = function() {
          console.log('Force closing lightbox...');
          closeLightbox();
          document.body.classList.remove('lightbox-open');
          document.body.style.overflow = '';
          lightbox.style.display = 'none';
        };
        
        // Add window resize handler to reset lightbox if needed
        window.addEventListener('resize', function() {
          if (lightbox.classList.contains('active')) {
            // Reset lightbox position and properties
            lightbox.style.display = 'flex';
            lightbox.style.pointerEvents = 'auto';
          }
        });
      });
    </script>
</body>
</html>
